<?xml version="1.0" encoding="UTF-8"?>
<xmi:XMI xmi:version="2.1" xmlns:uml="http://schema.omg.org/spec/UML/2.1" xmlns:xmi="http://schema.omg.org/spec/XMI/2.1">
  <xmi:Documentation exporter="Manual" exporterVersion="2.0">
    <exporter>Transfer Module Complete Model for EA 16.1</exporter>
    <exporterVersion>2.0 - Unified Repository Architecture</exporterVersion>
    <notice>This file contains Use Case, Activity, and Sequence diagrams for the Transfer Module</notice>
  </xmi:Documentation>

  <uml:Model xmi:type="uml:Model" xmi:id="root_model" name="Transfer Module - Complete Model">

    <!-- ================================================================== -->
    <!-- PACKAGE 1: USE CASE DIAGRAM -->
    <!-- ================================================================== -->

    <packagedElement xmi:type="uml:Package" xmi:id="uc_package" name="1. Use Cases">

      <!-- ACTORS -->

      <packagedElement xmi:type="uml:Actor" xmi:id="uc_actor_scheduler" name="Scheduler">
        <ownedComment xmi:id="uc_comment_scheduler" annotatedElement="uc_actor_scheduler">
          <body>Cron-based scheduler that triggers transfer flows automatically</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:Actor" xmi:id="uc_actor_admin" name="System Administrator">
        <ownedComment xmi:id="uc_comment_admin" annotatedElement="uc_actor_admin">
          <body>Manages transfer configurations, connections, and engine settings</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:Actor" xmi:id="uc_actor_monitor" name="Monitoring System">
        <ownedComment xmi:id="uc_comment_monitor" annotatedElement="uc_actor_monitor">
          <body>Monitors transfer execution, checks status, and generates reports</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:Actor" xmi:id="uc_actor_remote" name="Remote Server">
        <ownedComment xmi:id="uc_comment_remote" annotatedElement="uc_actor_remote">
          <body>External SFTP/FTP server hosting telecom network element files</body>
        </ownedComment>
      </packagedElement>

      <!-- USE CASES -->

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc1" name="Execute Transfer Flow">
        <ownedComment xmi:id="uc_comment_uc1" annotatedElement="uc1">
          <body>Main workflow: Start engine, execute handlers, download files, decompress, validate
Triggered by: Scheduler via cron job (t_flow.flow_cron)
Database tables: t_connection, t_transfer_engine, t_transfer_connection_result</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc2" name="Connect to Remote Server">
        <ownedComment xmi:id="uc_comment_uc2" annotatedElement="uc2">
          <body>Establish SFTP/FTP connection to remote server
Uses: TransferConnectionFactory
Configuration: t_server (IP, port, credentials)</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc3" name="List and Filter Files">
        <ownedComment xmi:id="uc_comment_uc3" annotatedElement="uc3">
          <body>Read remote file list and filter by lastModifiedTime
Incremental transfer: Only new/changed files since last run
Database: t_connection.last_modified_time</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc4" name="Download Files">
        <ownedComment xmi:id="uc_comment_uc4" annotatedElement="uc4">
          <body>Physical file transfer from remote to local /raw directory
Retry mechanism: t_connection.transfer_try_count_max_limit
Updates: t_transfer_connection_result (is_downloaded, file_size, transfer_try_count)</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc5" name="Store Transfer Results">
        <ownedComment xmi:id="uc_comment_uc5" annotatedElement="uc5">
          <body>Save file metadata and transfer status to database
Repository.saveResults() → t_transfer_connection_result
Repository.updateLastModifiedTime() → t_connection.last_modified_time</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc6" name="Decompress Files">
        <ownedComment xmi:id="uc_comment_uc6" annotatedElement="uc6">
          <body>Extract compressed files (.gz, .zip) with thread pool
Configuration: t_transfer_engine.decompress = true/false
Location: /processed directory</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc7" name="Validate XML Files">
        <ownedComment xmi:id="uc_comment_uc7" annotatedElement="uc7">
          <body>Validate XML files against XSD schema
Configuration: t_transfer_engine.validation = true/false
Error handling: Log and continue</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc8" name="Configure Transfer Settings">
        <ownedComment xmi:id="uc_comment_uc8" annotatedElement="uc8">
          <body>Manage transfer configurations via database
Tables: t_connection, t_transfer_engine, t_server, t_path, t_transfer_component
Settings: retry limits, time filters, thread counts, workflow flags</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc9" name="Manage Connections">
        <ownedComment xmi:id="uc_comment_uc9" annotatedElement="uc9">
          <body>Create, update, activate/deactivate connections
Database: t_connection (flow_id, server_id, path_id, transfer_work_type, filters)
Fields: is_active, last_modified_time, transfer_try_count limits</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc10" name="Manage Engine Configuration">
        <ownedComment xmi:id="uc_comment_uc10" annotatedElement="uc10">
          <body>Configure workflow steps and thread pool sizes
Database: t_transfer_engine
Flags: pre_transfer, on_transfer, decompress, validation, post_transfer
Thread counts: on_transfer_thread_count, decompress_thread_count, validation_thread_count</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc11" name="Monitor Transfer Status">
        <ownedComment xmi:id="uc_comment_uc11" annotatedElement="uc11">
          <body>View real-time transfer execution status and history
Query: t_transfer_connection_result, t_transfer_process_history
Metrics: file counts, sizes, success/failure rates, execution times</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc12" name="View Transfer History">
        <ownedComment xmi:id="uc_comment_uc12" annotatedElement="uc12">
          <body>Query historical transfer records
Database: t_transfer_connection_result (9.1MB - largest table)
Fields: flow_process_code, remote_file_name, is_downloaded, file_modified_time, transfer_try_count</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc13" name="View Process Statistics">
        <ownedComment xmi:id="uc_comment_uc13" annotatedElement="uc13">
          <body>View aggregated statistics per flow execution
Database: t_transfer_process_history
Statistics: total files, success count, failure count, total size, execution duration</body>
        </ownedComment>
      </packagedElement>

      <packagedElement xmi:type="uml:UseCase" xmi:id="uc14" name="Retry Failed Transfer">
        <ownedComment xmi:id="uc_comment_uc14" annotatedElement="uc14">
          <body>Automatic retry for failed transfers within limits
Configuration: t_connection.transfer_try_count_max_limit (default: 10)
Updates: t_transfer_connection_result.transfer_try_count</body>
        </ownedComment>
      </packagedElement>

      <!-- ASSOCIATIONS -->

      <packagedElement xmi:type="uml:Association" xmi:id="uc_assoc1">
        <memberEnd xmi:idref="uc_end1_scheduler"/>
        <memberEnd xmi:idref="uc_end1_uc1"/>
        <ownedEnd xmi:type="uml:Property" xmi:id="uc_end1_scheduler" type="uc_actor_scheduler"/>
        <ownedEnd xmi:type="uml:Property" xmi:id="uc_end1_uc1" type="uc1"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Association" xmi:id="uc_assoc2">
        <memberEnd xmi:idref="uc_end2_admin"/>
        <memberEnd xmi:idref="uc_end2_uc8"/>
        <ownedEnd xmi:type="uml:Property" xmi:id="uc_end2_admin" type="uc_actor_admin"/>
        <ownedEnd xmi:type="uml:Property" xmi:id="uc_end2_uc8" type="uc8"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Association" xmi:id="uc_assoc3">
        <memberEnd xmi:idref="uc_end3_monitor"/>
        <memberEnd xmi:idref="uc_end3_uc11"/>
        <ownedEnd xmi:type="uml:Property" xmi:id="uc_end3_monitor" type="uc_actor_monitor"/>
        <ownedEnd xmi:type="uml:Property" xmi:id="uc_end3_uc11" type="uc11"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Association" xmi:id="uc_assoc4">
        <memberEnd xmi:idref="uc_end4_uc2"/>
        <memberEnd xmi:idref="uc_end4_remote"/>
        <ownedEnd xmi:type="uml:Property" xmi:id="uc_end4_uc2" type="uc2"/>
        <ownedEnd xmi:type="uml:Property" xmi:id="uc_end4_remote" type="uc_actor_remote"/>
      </packagedElement>

      <!-- INCLUDE RELATIONSHIPS -->

      <packagedElement xmi:type="uml:Include" xmi:id="uc_include1">
        <includingCase xmi:idref="uc1"/>
        <addition xmi:idref="uc2"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Include" xmi:id="uc_include2">
        <includingCase xmi:idref="uc1"/>
        <addition xmi:idref="uc3"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Include" xmi:id="uc_include3">
        <includingCase xmi:idref="uc1"/>
        <addition xmi:idref="uc4"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Include" xmi:id="uc_include4">
        <includingCase xmi:idref="uc1"/>
        <addition xmi:idref="uc5"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Include" xmi:id="uc_include5">
        <includingCase xmi:idref="uc8"/>
        <addition xmi:idref="uc9"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Include" xmi:id="uc_include6">
        <includingCase xmi:idref="uc8"/>
        <addition xmi:idref="uc10"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Include" xmi:id="uc_include7">
        <includingCase xmi:idref="uc11"/>
        <addition xmi:idref="uc12"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Include" xmi:id="uc_include8">
        <includingCase xmi:idref="uc11"/>
        <addition xmi:idref="uc13"/>
      </packagedElement>

      <!-- EXTEND RELATIONSHIPS -->

      <packagedElement xmi:type="uml:Extend" xmi:id="uc_extend1">
        <extendedCase xmi:idref="uc1"/>
        <extension xmi:idref="uc6"/>
        <extensionLocation xmi:id="uc_extpoint1" name="after file download"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Extend" xmi:id="uc_extend2">
        <extendedCase xmi:idref="uc1"/>
        <extension xmi:idref="uc7"/>
        <extensionLocation xmi:id="uc_extpoint2" name="after decompression"/>
      </packagedElement>

      <packagedElement xmi:type="uml:Extend" xmi:id="uc_extend3">
        <extendedCase xmi:idref="uc1"/>
        <extension xmi:idref="uc14"/>
        <extensionLocation xmi:id="uc_extpoint3" name="on download failure"/>
      </packagedElement>

    </packagedElement>

    <!-- ================================================================== -->
    <!-- PACKAGE 2: ACTIVITY DIAGRAM -->
    <!-- ================================================================== -->

    <packagedElement xmi:type="uml:Activity" xmi:id="act_activity1" name="2. Transfer Flow - Activity Diagram">

      <!-- Initial Node -->
      <node xmi:type="uml:InitialNode" xmi:id="act_initial1" name="START"/>

      <!-- PHASE 1: ENGINE STARTUP -->

      <node xmi:type="uml:Action" xmi:id="act_step1" name="[Engine] startEngine(flowId)">
        <body>ENTRY POINT - Transfer workflow başlatılır
- Input: flowId (t_flow.id)
- Scheduler tarafından cron job ile tetiklenir
- Engine konfigürasyonunu yükler ve workflow'u başlatır
- Thread pool'ları initialize eder</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step2" name="[Engine] Repository.findConnections(flowId)">
        <body>DATABASE: t_connection tablosundan aktif connection'ları yükle
- Query: SELECT * FROM t_connection WHERE flow_id = ? AND is_active = true
- Returns: List&lt;Connection&gt; (server_id, path_id, filters, retry limits)
- Her connection bir SFTP/FTP bağlantısını temsil eder
- Connection başına bir Handler thread oluşturulacak</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step3" name="[Engine] Repository.getEngineConfig(flowId)">
        <body>DATABASE: t_transfer_engine tablosundan workflow konfigürasyonu
- Query: SELECT * FROM t_transfer_engine WHERE flow_id = ?
- Flags: pre_transfer, on_transfer, decompress, validation, post_transfer
- Thread counts: on_transfer_thread_count (default: 8), decompress_thread_count, validation_thread_count
- Bu flagler hangi adımların çalışacağını belirler</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step4" name="[Engine] preparePaths()">
        <body>DIRECTORY SETUP - Gerekli klasör yapısını oluştur
- Creates: /raw (download edilen dosyalar)
- Creates: /processed (decompress edilen dosyalar)
- Creates: /archive (işlenmiş dosyalar)
- Folder structure: /[component]/[date]/[raw|processed|archive]
- If exists: skip creation</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step5" name="[Engine] For Each Connection: Create Handler">
        <body>PARALLEL EXECUTION - Her connection için Handler thread oluştur
- ExecutorService thread pool kullanır (size: on_transfer_thread_count)
- Her connection için TransferBaseHandler instance yaratır
- Handler'lar parallel olarak çalışır (non-blocking)
- Engine tüm handler'ların tamamlanmasını bekler
- Thread pool: fixed size, bounded queue</body>
      </node>

      <!-- PHASE 2: HANDLER WORKFLOW -->

      <node xmi:type="uml:CallBehaviorAction" xmi:id="act_handler_start" name="[Handler] run()">
        <body>HANDLER THREAD BAŞLATILDI - Implements Runnable interface
- Her handler bir connection için çalışır
- Parallel thread execution (ExecutorService pool)
- Independent: bir handler'ın hatası diğerlerini etkilemez
- Life cycle: connect → transfer → disconnect
- Exception handling: log and continue (other handlers keep running)</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step6" name="[Handler] ConnectionFactory.connect(server, path)">
        <body>REMOTE CONNECTION - SFTP/FTP bağlantısı kur
- Input: t_server (IP, port, username, password, protocol)
- Protocol: SFTP (default) or FTP
- Connection timeout: 30 seconds
- Returns: boolean (success/failure)
- On failure: log error, throw ConnectionException
- CRITICAL DECISION POINT: Success/Failure determines next step</body>
      </node>

      <node xmi:type="uml:DecisionNode" xmi:id="act_decision_critical" name="Connection Success?"/>

      <node xmi:type="uml:Action" xmi:id="act_step_fail" name="[Handler] ConnectionFactory.disconnect()">
        <body>CONNECTION FAILED - Cleanup ve handler'ı sonlandır
- Reason: Wrong credentials, network error, server unreachable
- Actions: close socket, release resources, log error
- Database: connection failure kaydedilmez (no results to save)
- Handler exits: diğer handler'lar çalışmaya devam eder
- End state: HANDLER FAILED (individual failure, not system failure)</body>
      </node>

      <node xmi:type="uml:ActivityFinalNode" xmi:id="act_final_fail" name="END - HANDLER FAILED"/>

      <node xmi:type="uml:Action" xmi:id="act_step7" name="[Handler] Repository.getLastModifiedTime(connectionId)">
        <body>DATABASE: Incremental transfer için son dosya zamanını oku
- Query: SELECT last_modified_time FROM t_connection WHERE id = ?
- Purpose: Sadece yeni/değişmiş dosyaları transfer et
- If NULL: ilk transfer, tüm dosyalar indirilir
- If NOT NULL: sadece lastModifiedTime'dan sonraki dosyalar
- Performance: milyonlarca dosya arasından filtering</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step8" name="[Handler] ConnectionFactory.listFiles(path)">
        <body>REMOTE FILE LISTING - Uzak sunucudaki dosya listesini oku
- SFTP command: ls -la /remote/path
- Returns: List&lt;RemoteFile&gt; (name, size, modifiedTime, permissions)
- Recursive: path_walk_method = NESTED ise subdirectory'leri de tarar
- Performance: 10,000+ files için optimize edilmiş
- Metadata: file name, size (bytes), modified time, path</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step9" name="[Handler] filterFiles(lastModifiedTime)">
        <body>FILE FILTERING - Sadece yeni/değişmiş dosyaları seç
- Filter: file.modifiedTime &gt; connection.lastModifiedTime
- Additional filters: file size, extension, naming pattern
- Fragment time filter: min/max time limits (t_connection config)
- Retry filter: transfer_try_count &lt; max_limit
- Result: Filtered file list ready for download
- Performance gain: Sadece delta transfer (incremental)</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step10" name="[Handler] ConnectionFactory.downloadFile()">
        <body>FILE DOWNLOAD - Fiziksel dosya transferi (LOOP: her dosya için)
- Protocol: SFTP GET command, binary mode
- Target: /raw/[component]/[date]/[filename]
- Retry mechanism: max 10 attempts (configurable)
- Buffer size: 64KB chunks
- Progress tracking: bytes transferred, speed (MB/s)
- On error: increment transfer_try_count, retry or skip
- Typical files: XML.gz (Huawei eNodeB PM: 1-50MB, CM: 100KB-5MB)</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step11" name="[Handler] Repository.saveResults(fileList)">
        <body>DATABASE: Transfer sonuçlarını kaydet (BULK INSERT)
- Table: t_transfer_connection_result (9.1MB - en büyük tablo)
- Fields: file_id, remote_file_name, is_downloaded, file_size,
         transfer_try_count, file_modified_time, file_read_time,
         file_transfer_time, source_node_name, fragment_time
- Bulk insert: 1000+ records at once (batch operation)
- Transaction: COMMIT on success, ROLLBACK on error
- Purpose: Transfer history, audit trail, debugging</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step12" name="[Handler] Repository.updateLastModifiedTime(connectionId, time)">
        <body>DATABASE: Son dosya zamanını güncelle (incremental transfer)
- Query: UPDATE t_connection SET last_modified_time = ? WHERE id = ?
- Value: MAX(file.modifiedTime) from downloaded files
- Purpose: Bir sonraki çalıştırmada sadece yeni dosyalar indirilecek
- Critical for performance: 10,000+ files günlük artış
- Example: 2024-07-07 16:01:53.736 → 2024-07-08 03:30:00.000</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step13" name="[Handler] ConnectionFactory.disconnect()">
        <body>CONNECTION CLOSE - Bağlantıyı kapat, kaynakları serbest bırak
- SFTP: close session, disconnect socket
- Cleanup: temp files, buffers, file handles
- Release: thread resources, memory
- Logging: transfer summary (file count, total size, duration)
- Always execute: finally block (even on exception)</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step14" name="[Handler] Notify Engine: handlerComplete()">
        <body>ASYNC NOTIFICATION - Handler tamamlandı, Engine'e bildir
- Async message: non-blocking, fire-and-forget
- CountDownLatch.countDown() veya CompletableFuture.complete()
- Engine: tüm handler'ların bitmesini bekliyor
- Success: bu handler başarıyla tamamlandı
- Next: Engine post-processing (decompress, validation)</body>
      </node>

      <!-- PHASE 3: ENGINE POST-PROCESSING -->

      <node xmi:type="uml:Action" xmi:id="act_step15" name="[Engine] awaitHandlerCompletion()">
        <body>SYNCHRONIZATION POINT - Tüm parallel handler'ların bitmesini bekle
- Mechanism: CountDownLatch.await() or ExecutorService.awaitTermination()
- Blocking call: Engine thread bu noktada bekler
- Timeout: configurable (default: 1 hour)
- Success: tüm handler'lar tamamlandı (success or failure)
- On timeout: log warning, proceed anyway
- Result: downloaded files ready in /raw directory</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step16" name="[Engine] decompress()">
        <body>DECOMPRESSION - Sıkıştırılmış dosyaları aç (.gz, .zip)
- Internal operation (no separate lifeline/class)
- Config: t_transfer_engine.decompress = true/false
- Thread pool: decompress_thread_count (default: 8 threads)
- Input: /raw/*.gz, /raw/*.zip
- Output: /processed/*.xml
- Libraries: Java GZIPInputStream, ZipInputStream
- Error handling: log and continue (corrupt files are skipped)
- Typical: 100MB .gz → 500MB XML (5x expansion)
- Performance: 8 threads × 10MB/s = 80MB/s decompression rate</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step17" name="[Engine] validation()">
        <body>XML VALIDATION - XML dosyalarını XSD schema'ya göre doğrula
- Internal operation (no separate lifeline/class)
- Config: t_transfer_engine.validation = true/false
- Thread pool: validation_thread_count (default: 8 threads)
- Input: /processed/*.xml
- XSD schema: vendor-specific (Huawei, Ericsson, Nokia)
- Validation: javax.xml.validation.Validator
- Error handling: log invalid files, continue processing
- Purpose: corrupt/malformed XML'leri Parser'a göndermemek
- Performance: 1000 files/second (small XMLs)</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step18" name="[Engine] Repository.saveProcessHistory(flowId, stats)">
        <body>DATABASE: Flow execution istatistiklerini kaydet
- Table: t_transfer_process_history
- Fields: flow_process_code, total_files, success_count, failure_count,
         total_size (bytes), execution_duration (ms), start_time, end_time
- Purpose: Performance monitoring, trend analysis, debugging
- Statistics: toplam dosya sayısı, başarı oranı, süre, toplam boyut
- Example: flow_id=111, total=1000, success=998, failed=2, size=50GB, duration=180s</body>
      </node>

      <node xmi:type="uml:Action" xmi:id="act_step19" name="[Engine] postEngine()">
        <body>POST-PROCESSING - Archive, notifications, trigger next module
- Archive: move /processed files to /archive (optional cleanup)
- Reports: generate summary report (file counts, sizes, errors)
- Notifications: email/SMS alerts on success/failure
- Trigger: start next module (Parser) via message queue or REST API
- Cleanup: delete old files (retention policy: 30 days)
- Logging: final summary to application log
- Integration: Kafka, RabbitMQ, or HTTP callback</body>
      </node>

      <node xmi:type="uml:ActivityFinalNode" xmi:id="act_final1" name="END - SUCCESS"/>

      <!-- CONTROL FLOWS -->

      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow1" source="act_initial1" target="act_step1"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow2" source="act_step1" target="act_step2"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow3" source="act_step2" target="act_step3"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow4" source="act_step3" target="act_step4"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow5" source="act_step4" target="act_step5"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow6" source="act_step5" target="act_handler_start"/>

      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow1" source="act_handler_start" target="act_step6"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow2" source="act_step6" target="act_decision_critical"/>

      <!-- Decision: Connection Success - YES branch -->
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow3" source="act_decision_critical" target="act_step7" name="[connection successful]">
        <guard xmi:type="uml:OpaqueExpression" xmi:id="act_guard_yes">
          <body>connection successful</body>
        </guard>
      </edge>

      <!-- Decision: Connection Success - NO branch -->
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow4" source="act_decision_critical" target="act_step_fail" name="[connection failed]">
        <guard xmi:type="uml:OpaqueExpression" xmi:id="act_guard_no">
          <body>connection failed</body>
        </guard>
      </edge>

      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow_fail" source="act_step_fail" target="act_final_fail"/>

      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow5" source="act_step7" target="act_step8"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow6" source="act_step8" target="act_step9"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow7" source="act_step9" target="act_step10"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow8" source="act_step10" target="act_step11"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow9" source="act_step11" target="act_step12"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow10" source="act_step12" target="act_step13"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow11" source="act_step13" target="act_step14"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_hflow12" source="act_step14" target="act_step15"/>

      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow7" source="act_step15" target="act_step16"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow8" source="act_step16" target="act_step17"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow9" source="act_step17" target="act_step18"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow10" source="act_step18" target="act_step19"/>
      <edge xmi:type="uml:ControlFlow" xmi:id="act_flow11" source="act_step19" target="act_final1"/>

    </packagedElement>

    <!-- ================================================================== -->
    <!-- PACKAGE 3: SEQUENCE DIAGRAM -->
    <!-- ================================================================== -->

    <packagedElement xmi:type="uml:Interaction" xmi:id="seq_interaction1" name="3. Transfer Flow - Sequence Diagram">

      <!-- LIFELINES (5 total) -->

      <lifeline xmi:id="seq_lifeline_client" name="Client (Scheduler)" represents="seq_client_obj"/>
      <lifeline xmi:id="seq_lifeline_engine" name=":TransferBaseEngine" represents="seq_engine_obj"/>
      <lifeline xmi:id="seq_lifeline_handler" name=":TransferBaseHandler" represents="seq_handler_obj"/>
      <lifeline xmi:id="seq_lifeline_factory" name=":TransferConnectionFactory" represents="seq_factory_obj"/>
      <lifeline xmi:id="seq_lifeline_repository" name=":Repository" represents="seq_repository_obj"/>

      <!-- PHASE 1: ENGINE STARTUP -->

      <message xmi:id="seq_msg1" name="startEngine(flowId)" messageSort="synchCall"
               sendEvent="seq_send1" receiveEvent="seq_recv1"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send1"
                covered="seq_lifeline_client" message="seq_msg1"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv1"
                covered="seq_lifeline_engine" message="seq_msg1"/>

      <message xmi:id="seq_msg2" name="findConnections(flowId)" messageSort="synchCall"
               sendEvent="seq_send2" receiveEvent="seq_recv2"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send2"
                covered="seq_lifeline_engine" message="seq_msg2"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv2"
                covered="seq_lifeline_repository" message="seq_msg2"/>

      <message xmi:id="seq_msg3" name="List&lt;Connection&gt;" messageSort="reply"
               sendEvent="seq_send3" receiveEvent="seq_recv3"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send3"
                covered="seq_lifeline_repository" message="seq_msg3"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv3"
                covered="seq_lifeline_engine" message="seq_msg3"/>

      <message xmi:id="seq_msg4" name="getEngineConfig(flowId)" messageSort="synchCall"
               sendEvent="seq_send4" receiveEvent="seq_recv4"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send4"
                covered="seq_lifeline_engine" message="seq_msg4"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv4"
                covered="seq_lifeline_repository" message="seq_msg4"/>

      <message xmi:id="seq_msg5" name="EngineConfig" messageSort="reply"
               sendEvent="seq_send5" receiveEvent="seq_recv5"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send5"
                covered="seq_lifeline_repository" message="seq_msg5"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv5"
                covered="seq_lifeline_engine" message="seq_msg5"/>

      <message xmi:id="seq_msg6" name="preparePaths()" messageSort="synchCall"
               sendEvent="seq_send6" receiveEvent="seq_recv6"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send6"
                covered="seq_lifeline_engine" message="seq_msg6"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv6"
                covered="seq_lifeline_engine" message="seq_msg6"/>

      <!-- PHASE 2: HANDLER WORKFLOW (simplified - showing one iteration) -->

      <message xmi:id="seq_msg7" name="&lt;&lt;create&gt;&gt;" messageSort="createMessage"
               sendEvent="seq_send7" receiveEvent="seq_recv7"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send7"
                    covered="seq_lifeline_engine" message="seq_msg7"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv7"
                    covered="seq_lifeline_handler" message="seq_msg7"/>

      <message xmi:id="seq_msg8" name="run()" messageSort="asynchCall"
               sendEvent="seq_send8" receiveEvent="seq_recv8"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send8"
                    covered="seq_lifeline_engine" message="seq_msg8"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv8"
                    covered="seq_lifeline_handler" message="seq_msg8"/>

      <message xmi:id="seq_msg9" name="connect(server, path)" messageSort="synchCall"
               sendEvent="seq_send9" receiveEvent="seq_recv9"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send9"
                covered="seq_lifeline_handler" message="seq_msg9"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv9"
                covered="seq_lifeline_factory" message="seq_msg9"/>

      <message xmi:id="seq_msg10" name="success" messageSort="reply"
               sendEvent="seq_send10" receiveEvent="seq_recv10"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send10"
                covered="seq_lifeline_factory" message="seq_msg10"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv10"
                covered="seq_lifeline_handler" message="seq_msg10"/>

      <message xmi:id="seq_msg11" name="getLastModifiedTime(connectionId)" messageSort="synchCall"
               sendEvent="seq_send11" receiveEvent="seq_recv11"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send11"
                covered="seq_lifeline_handler" message="seq_msg11"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv11"
                covered="seq_lifeline_repository" message="seq_msg11"/>

      <message xmi:id="seq_msg12" name="lastModifiedTime" messageSort="reply"
               sendEvent="seq_send12" receiveEvent="seq_recv12"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send12"
                covered="seq_lifeline_repository" message="seq_msg12"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv12"
                covered="seq_lifeline_handler" message="seq_msg12"/>

      <message xmi:id="seq_msg13" name="listFiles(path)" messageSort="synchCall"
               sendEvent="seq_send13" receiveEvent="seq_recv13"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send13"
                covered="seq_lifeline_handler" message="seq_msg13"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv13"
                covered="seq_lifeline_factory" message="seq_msg13"/>

      <message xmi:id="seq_msg14" name="fileList" messageSort="reply"
               sendEvent="seq_send14" receiveEvent="seq_recv14"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send14"
                covered="seq_lifeline_factory" message="seq_msg14"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv14"
                covered="seq_lifeline_handler" message="seq_msg14"/>

      <message xmi:id="seq_msg15" name="downloadFile(filename)" messageSort="synchCall"
               sendEvent="seq_send15" receiveEvent="seq_recv15"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send15"
                covered="seq_lifeline_handler" message="seq_msg15"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv15"
                covered="seq_lifeline_factory" message="seq_msg15"/>

      <message xmi:id="seq_msg16" name="file" messageSort="reply"
               sendEvent="seq_send16" receiveEvent="seq_recv16"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send16"
                covered="seq_lifeline_factory" message="seq_msg16"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv16"
                covered="seq_lifeline_handler" message="seq_msg16"/>

      <message xmi:id="seq_msg17" name="saveResults(fileList)" messageSort="synchCall"
               sendEvent="seq_send17" receiveEvent="seq_recv17"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send17"
                covered="seq_lifeline_handler" message="seq_msg17"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv17"
                covered="seq_lifeline_repository" message="seq_msg17"/>

      <message xmi:id="seq_msg18" name="" messageSort="reply"
               sendEvent="seq_send18" receiveEvent="seq_recv18"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send18"
                covered="seq_lifeline_repository" message="seq_msg18"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv18"
                covered="seq_lifeline_handler" message="seq_msg18"/>

      <message xmi:id="seq_msg19" name="updateLastModifiedTime(connectionId, time)" messageSort="synchCall"
               sendEvent="seq_send19" receiveEvent="seq_recv19"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send19"
                covered="seq_lifeline_handler" message="seq_msg19"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv19"
                covered="seq_lifeline_repository" message="seq_msg19"/>

      <message xmi:id="seq_msg20" name="" messageSort="reply"
               sendEvent="seq_send20" receiveEvent="seq_recv20"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send20"
                covered="seq_lifeline_repository" message="seq_msg20"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv20"
                covered="seq_lifeline_handler" message="seq_msg20"/>

      <message xmi:id="seq_msg21" name="disconnect()" messageSort="synchCall"
               sendEvent="seq_send21" receiveEvent="seq_recv21"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send21"
                covered="seq_lifeline_handler" message="seq_msg21"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv21"
                covered="seq_lifeline_factory" message="seq_msg21"/>

      <message xmi:id="seq_msg22" name="" messageSort="reply"
               sendEvent="seq_send22" receiveEvent="seq_recv22"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send22"
                covered="seq_lifeline_factory" message="seq_msg22"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv22"
                covered="seq_lifeline_handler" message="seq_msg22"/>

      <message xmi:id="seq_msg23" name="handlerComplete()" messageSort="asynchCall"
               sendEvent="seq_send23" receiveEvent="seq_recv23"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send23"
                covered="seq_lifeline_handler" message="seq_msg23"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv23"
                covered="seq_lifeline_engine" message="seq_msg23"/>

      <!-- PHASE 3: ENGINE POST-PROCESSING -->

      <message xmi:id="seq_msg26" name="awaitHandlerCompletion()" messageSort="synchCall"
               sendEvent="seq_send26" receiveEvent="seq_recv26"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send26"
                covered="seq_lifeline_engine" message="seq_msg26"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv26"
                covered="seq_lifeline_engine" message="seq_msg26"/>

      <message xmi:id="seq_msg27" name="decompress()" messageSort="synchCall"
               sendEvent="seq_send27" receiveEvent="seq_recv27"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send27"
                covered="seq_lifeline_engine" message="seq_msg27"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv27"
                covered="seq_lifeline_engine" message="seq_msg27"/>

      <message xmi:id="seq_msg28" name="validation()" messageSort="synchCall"
               sendEvent="seq_send28" receiveEvent="seq_recv28"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send28"
                covered="seq_lifeline_engine" message="seq_msg28"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv28"
                covered="seq_lifeline_engine" message="seq_msg28"/>

      <message xmi:id="seq_msg29" name="saveProcessHistory(flowId, stats)" messageSort="synchCall"
               sendEvent="seq_send29" receiveEvent="seq_recv29"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send29"
                covered="seq_lifeline_engine" message="seq_msg29"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv29"
                covered="seq_lifeline_repository" message="seq_msg29"/>

      <message xmi:id="seq_msg30" name="" messageSort="reply"
               sendEvent="seq_send30" receiveEvent="seq_recv30"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send30"
                covered="seq_lifeline_repository" message="seq_msg30"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv30"
                covered="seq_lifeline_engine" message="seq_msg30"/>

      <message xmi:id="seq_msg31" name="" messageSort="reply"
               sendEvent="seq_send31" receiveEvent="seq_recv31"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_send31"
                covered="seq_lifeline_engine" message="seq_msg31"/>
      <fragment xmi:type="uml:MessageOccurrenceSpecification" xmi:id="seq_recv31"
                covered="seq_lifeline_client" message="seq_msg31"/>

    </packagedElement>

  </uml:Model>
</xmi:XMI>
